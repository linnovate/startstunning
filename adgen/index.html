<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Wix Ad Generator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.css">
    <script type="text/javascript" src="//static.parastorage.com/services/js-sdk/1.61.0/js/wix.min.js"></script>
    <script src="/adgen/js/underscore-min.js"></script>
    <script src="/adgen/js/jquery.js"></script>
    <script src="/adgen/js/kinetic.min.js"></script>
    <script src="/adgen/js/meme-ad.js"></script>
</head>
<body>

<style>
    body {
        background-color: transparent;
    }
    canvas:hover {
        cursor: pointer;
    }

    html, body {
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
    }

    .col {
        float: left;
        margin-right: 14px;
    }

    .last {
        margin-right: 0;
    }

    .col-center {
        width: 726px;
        height: 100%;
        background-color: yellow;
    }

    .col-right {
        width: 1640px;
        margin-top: -5px;
    }

    .col-left {
        width: 1090px;
        margin-top: -5px;
    }

    .flex {
        display: flex;
        overflow: hidden;
        flex-flow: row wrap;
        justify-content: space-between;
        align-content: flex-start;
    }

    .square {
        width: 265px;
        height: 265px;
        background: blue;
        margin: 5px 0;
        opacity: 0.4;
        transition: opacity .5s ease-out;
    }

    .square:hover {
        opacity: 1;
    }

    .overflow {
        overflow: hidden;
        height: 100%;
        width: 100%;
        position: relative;
        margin: 0 auto;
    }

    .wrap {
        width: 3484px;
        height: 1090px;
        position: absolute;
        left: 50%;
        margin-left: -1587px;
    }

</style>


<div class="overflow">
    <div class="wrap">
        <div class="col-left flex col">
        </div>

        <div class="col-center col">
            center
        </div>

        <div class="col-right flex col last">
        </div>
    </div>

</div>
<div id="heightStage" style="display: none;"></div>

<script>
    var wixSelTypes = [],
            wixSelBusinessName = '',
            wixSelCategory = '',
            adData = new $.wixAdData();

    $(document).ready(function () {
        adData.init(function () {
            this.popEl();
//            $('.entity-pick-container').wixAdPicker({}, this);
        });

    });


    function wixAdShowForm() {
        var selectedItems = $('.entity-type-item.selected');

        selectedItems.each(function () {
            wixSelTypes.push($(this).data('wix-ad-pick'));
        });

        $('.form-container').wixAdForm({types: wixSelTypes}, adData);

        $('.entity-pick-container').hide();
        $('#business-name').focus();
    }

    function wixAdShowAds() {
        wixSelBusinessName = $('#business-name').val();
        wixSelCategory = $('#ad-category').val();

        $('.form-container').hide();

        var sets = [];
        _.each(wixSelTypes, function (enType) {
            sets.push({
                type: enType,
                category: wixSelCategory
            })
        });

        $('.meme-container').wixAdLayout({
            layout: 'col2',
            caption: wixSelBusinessName,
            subSetsIfOneSet: 2,
            sets: sets
        }, adData);

        $('.meme-ad').wixAdMeme();
    }

    function showImage(src) {
        window.open(src, '_blank', 'toolbar=0,location=0,menubar=0');
    }
</script>

<!--templates-->
<script type="text/template" class="tpl-entity-pick">
    <div class="mb40 row">
        <% _.each(data, function(chuncked) { %>
        <ul>
            <% _.each(chuncked, function(item) { %>
            <li class="pull-left">
                <img class="entity-type-item" src="<%- item.url %>" data-wix-ad-pick="<%- item.name %>"
                     alt="<%- item.name %>">
            </li>
            <% }); %>
        </ul>
        <% }); %>
    </div>

    <div class="text-center">
        <button class="btn btn-blue-white" id="btn-goto-form" onclick="wixAdShowForm()" disabled>Next</button>
    </div>

</script>


<script type="text/template" class="tpl-form">
    <div class="wix-ad-form mb40">
        <h3 class="text-center">All right! What's your business's name?</h3>
        <input class="form-control" type="text" placeholder="For example: Mike's Swimming Lessons" name="business-name"
               id="business-name">
        <br>
        <br>

        <h3 class="text-center">Which category does your business fit into?</h3>
        <select id="ad-category">
            <% _.each(data, function(catName) { %>
            <option value="<%- catName %>"><%- catName.capitalize() %></option>
            <% }); %>
        </select>
        <br>
        <br>

    </div>

    <div class="text-center">
        <button class="btn btn-blue-white" id="btn-goto-ads" onclick="wixAdShowAds()" disabled>Next</button>
    </div>
</script>


<script type="text/template" class="tpl-col2">
    <% _.each(groupItems, function(groupItem, groupKey) { %>
    <div class="row meme-group meme-group-<%- groupKey %>">
        <% _.each(groupItem, function(colItems, colIndex) { %>

        <% if (colIndex == 1) { %>
        <div class="col-<%- colIndex %> col-md-4">
            <% _.each(colItems, function(item) { %>
            <div class="meme-ad" data-wix-ad-src="<%- item.url %>" data-wix-ad-text="<%- caption %>"></div>
            <% }); %>
        </div>
        <% } %>

        <% if (colIndex == 2) { %>
        <div class="col-<%- colIndex %> col-md-8">
            <% _.each(colItems, function(item) { %>
            <div class="pull-left meme-ad" data-wix-ad-src="<%- item.url %>" data-wix-ad-text="<%- caption %>"></div>
            <% }); %>
        </div>
        <% } %>

        <% }); %>
    </div>
    <% }); %>
</script>

</body>
</html>